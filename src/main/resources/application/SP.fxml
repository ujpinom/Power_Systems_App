<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.MenuButton?>
<?import javafx.scene.control.MenuItem?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.TitledPane?>
<?import javafx.scene.control.ToggleButton?>
<?import javafx.scene.control.ToggleGroup?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>

<BorderPane maxHeight="-Infinity" maxWidth="-Infinity" minHeight="-Infinity" minWidth="-Infinity" prefHeight="768.0" prefWidth="1280.0" xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" fx:controller="application.SPController">
   
   <!-- TOP: RIBBON INTERFACE -->
   <top>
      <TabPane tabClosingPolicy="UNAVAILABLE" BorderPane.alignment="CENTER">
        <tabs>
          <!-- TAB 1: HOME (Edit & General) -->
          <Tab text="Home">
            <content>
              <HBox spacing="10.0" styleClass="tab-content-area">
                 <children>
                    <!-- Group: Edit Actions -->
                    <HBox styleClass="ribbon-group">
                       <children>
                          <Button fx:id="undo1" mnemonicParsing="false" onAction="#borrarUltimoElemento" text="Undo" />
                          <Button fx:id="undo" mnemonicParsing="false" onAction="#limpiarArea" text="Clear Canvas" />
                       </children>
                    </HBox>
                     <!-- Group: Quick Run -->
                    <HBox styleClass="ribbon-group">
                        <children>
                            <Button fx:id="ejecutar" mnemonicParsing="false" onAction="#ejecutar" text="Run Calculation" style="-fx-font-weight: bold;" />
                        </children>
                    </HBox>
                 </children>
              </HBox>
            </content>
          </Tab>
          
          <!-- TAB 2: ANALYSIS (Simulation Settings) -->
          <Tab text="Analysis">
            <content>
              <HBox spacing="10.0" styleClass="tab-content-area">
                 <children>
                    <!-- Group: Study Type -->
                    <HBox styleClass="ribbon-group">
                       <children>
                          <MenuButton fx:id="flujos" mnemonicParsing="false" text="Flow Method">
                            <items>
                              <MenuItem fx:id="Action1" mnemonicParsing="false" onAction="#Action1" text="Newton Raphson" />
                              <MenuItem fx:id="GaussSeidel" mnemonicParsing="false" onAction="#GaussSeidel" text="Gauss-Seidel" />
                            </items>
                          </MenuButton>
                          <MenuButton fx:id="tiposFalla" mnemonicParsing="false" text="Short Circuit">
                            <items>
                              <MenuItem fx:id="fallattrifa" mnemonicParsing="false" onAction="#fallaTrifasica" text="3-Phase" />
                              <MenuItem fx:id="fallaMono" mnemonicParsing="false" onAction="#fallaMono" text="Line-Ground" />
                              <MenuItem fx:id="fallaLaL" mnemonicParsing="false" onAction="#fallaLaL" text="Line-Line" />
                              <MenuItem fx:id="fallaLLT" mnemonicParsing="false" onAction="#fallaLLTierra" text="LL-Ground" />
                            </items>
                          </MenuButton>
                       </children>
                    </HBox>
                    
                    <!-- Group: Visualization -->
                     <HBox styleClass="ribbon-group">
                       <children>
                          <MenuButton fx:id="visualizacion" mnemonicParsing="false" text="Reports">
                             <items>
                                <MenuItem fx:id="matrizSecuencia" mnemonicParsing="false" onAction="#fallaTrifasica" text="Sequence Matrices" />
                                <MenuItem fx:id="fallaTabular" mnemonicParsing="false" onAction="#fallaMono" text="Fault Report" />
                                <MenuItem fx:id="flujoTabular" mnemonicParsing="false" onAction="#fallaLaL" text="Flow Report" />
                             </items>
                          </MenuButton>
                       </children>
                    </HBox>
                 </children>
              </HBox>
            </content>
          </Tab>
        </tabs>
      </TabPane>
   </top>

   <!-- LEFT: TOOLBOX SIDEBAR -->
   <left>
      <VBox prefWidth="90.0" spacing="5.0" style="-fx-background-color: #f0f0f0; -fx-border-color: transparent #9e9e9e transparent transparent;" BorderPane.alignment="CENTER">
         <children>
            <Label text="Toolbox" style="-fx-font-weight: bold; -fx-padding: 5; -fx-alignment: CENTER;" maxWidth="Infinity" />
            <Separator />
            <VBox spacing="5.0" alignment="TOP_CENTER" style="-fx-padding: 5;">
                 <ToggleButton fx:id="none" mnemonicParsing="false" onAction="#editionSelected" text="Select" prefWidth="70.0">
                     <toggleGroup>
                        <ToggleGroup fx:id="group" />
                     </toggleGroup>
                     <tooltip><Tooltip text="Selection/Edit Mode" /></tooltip>
                  </ToggleButton>
                  <Separator />
                  <ToggleButton fx:id="barra" mnemonicParsing="false" onAction="#barraSelected" text="Bus" toggleGroup="$group" prefWidth="70.0">
                     <tooltip><Tooltip text="Add Bus" /></tooltip>
                  </ToggleButton>
                  <ToggleButton fx:id="linea" mnemonicParsing="false" onAction="#lineaSelected" text="Line" toggleGroup="$group" prefWidth="70.0">
                     <tooltip><Tooltip text="Add Line" /></tooltip>
                  </ToggleButton>
                  <ToggleButton fx:id="trafo" mnemonicParsing="false" onAction="#trafoSelected" text="Trafo" toggleGroup="$group" prefWidth="70.0">
                     <tooltip><Tooltip text="Add Transformer" /></tooltip>
                  </ToggleButton>
                  <ToggleButton fx:id="carga" mnemonicParsing="false" onAction="#cargaSelected" text="Load" toggleGroup="$group" prefWidth="70.0">
                     <tooltip><Tooltip text="Add Load" /></tooltip>
                  </ToggleButton>
                  <ToggleButton fx:id="generador" mnemonicParsing="false" onAction="#genSelected" text="Gen" toggleGroup="$group" prefWidth="70.0">
                     <tooltip><Tooltip text="Add Generator" /></tooltip>
                  </ToggleButton>
                  <ToggleButton fx:id="banco" mnemonicParsing="false" onAction="#bancoSelected" text="Cap" toggleGroup="$group" prefWidth="70.0">
                     <tooltip><Tooltip text="Add Capacitor Bank" /></tooltip>
                  </ToggleButton>
                   <ToggleButton fx:id="Compensador" mnemonicParsing="false" onAction="#compensadorSelected" text="SVC" toggleGroup="$group" prefWidth="70.0">
                     <tooltip><Tooltip text="Add Static Compensator" /></tooltip>
                  </ToggleButton>
            </VBox>
         </children>
      </VBox>
   </left>

   <!-- CENTER: CANVAS -->
   <center>
      <AnchorPane fx:id="areaDibujo" onMouseClicked="#mouseClicked" onMouseDragged="#dragEvent" onMouseMoved="#mouseEvent" BorderPane.alignment="CENTER" />
   </center>

   <!-- BOTTOM: OUTPUT & STATUS -->
   <bottom>
      <VBox BorderPane.alignment="CENTER">
         <children>
             <!-- Status Row -->
             <HBox styleClass="status-bar" alignment="CENTER_LEFT" spacing="10.0" style="-fx-border-width: 1 0 0 0; -fx-border-color: #9e9e9e;">
                 <children>
                    <Label text="Element:" styleClass="status-label" />
                    <TextField fx:id="infoElemento" disable="true" editable="false" prefWidth="200.0" text="-" />
                    <Label text="Task:" styleClass="status-label" />
                    <TextField fx:id="infoTare" disable="true" editable="false" prefWidth="200.0" text="Idle" />
                    <Label text="Base:" styleClass="status-label" />
                    <TextField fx:id="MVAbase" alignment="CENTER" disable="true" editable="false" prefWidth="80.0" text="100 MVA" />
                    <Separator orientation="VERTICAL" />
                    <TextField fx:id="infoPosiMouse" disable="true" editable="false" prefWidth="150.0" text="X=0.0 Y=0.0" style="-fx-background-color: transparent; -fx-border-color: transparent;" alignment="CENTER_RIGHT" />
                 </children>
                 <padding>
                    <Insets top="2" right="5" bottom="2" left="5"/>
                 </padding>
             </HBox>
             
             <!-- Collapsible/Resizable Log Area (Using TitledPane for structure) -->
             <TitledPane text="Output Logs &amp; Results" expanded="true" animated="false">
                <content>
                    <HBox spacing="5.0" prefHeight="120.0">
                        <children>
                             <VBox HBox.hgrow="ALWAYS">
                                <Label text="System Log" style="-fx-font-size: 10px; -fx-text-fill: #666;" />
                                <TextArea fx:id="display" editable="false" wrapText="true" VBox.vgrow="ALWAYS" />
                             </VBox>
                             <VBox HBox.hgrow="ALWAYS">
                                <Label text="Calculation Results" style="-fx-font-size: 10px; -fx-text-fill: #666;" />
                                <TextArea fx:id="infoFlujo" editable="false" VBox.vgrow="ALWAYS" />
                             </VBox>
                        </children>
                    </HBox>
                </content>
             </TitledPane>
         </children>
      </VBox>
   </bottom>

</BorderPane>
